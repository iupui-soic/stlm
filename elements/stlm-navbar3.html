<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-demo-helpers/demo-pages-shared-styles.html">
<link rel="import" href="../bower_components/vaadin-upload/vaadin-upload.html">
<link rel="import" href="../bower_components/paper-collapse-item/paper-collapse-item.html">
<link rel="import" href="../bower_components/paper-collapse-item/paper-collapse-group.html">

<link rel="import" href="simple-dialog.html">

<script src="../bower_components/web-animations-js/web-animations-next-lite.min.js"></script>
<dom-module id="stlm-navbar3">
    <template>
        <style>
            :host {
                display: block;
            }

            paper-button {
                min-width: 30px;
                height: 20px;
                color: white;
            }

            paper-button.green {
                background-color: var(--paper-green-500);
            }

            paper-button.disabled {
                min-width: 30px;
                height: 20px;
            }

            paper-button.red {
                background-color: var(--paper-red-500);
            }

            paper-toolbar {
                --paper-toolbar-height: 30px;
            }
        </style>
        <paper-toolbar>
            <paper-menu-button slot="top" style="width:20%">
                <paper-button slot="dropdown-trigger">[[selectedCourseName]]
                    <iron-icon icon="chrome-reader-mode"></iron-icon>
                </paper-button>
                <paper-listbox slot="dropdown-content" selected="{{selectedCourseName}}" attr-for-selected="coursename">
                    <template is="dom-repeat" items="[[suggestions]]" as="suggestion">
                        <paper-item coursename="[[suggestion.name]]">[[suggestion.name]]</paper-item>
                    </template>
                </paper-listbox>
            </paper-menu-button>
            <paper-button style="width:20%" slot="top">Statistical Analysis&nbsp;<iron-icon
                    icon="social:poll"></iron-icon>
            </paper-button>
            <paper-button style="width:20%" slot="top">SQL&nbsp;<iron-icon icon="sort"></iron-icon>
            </paper-button>
            <paper-menu-button slot="top" style="width:20%">
                <paper-button slot="dropdown-trigger">Submission&nbsp;<iron-icon
                        icon="assignment-turned-in"></iron-icon>
                </paper-button>
                <paper-listbox slot="dropdown-content">
                    <paper-item>Spreadsheet</paper-item>
                    <paper-item>Data Flow Diagram</paper-item>
                    <paper-item on-tap="toggleDialog">Upload Files</paper-item>
                </paper-listbox>
            </paper-menu-button>
            <paper-menu-button slot="top" style="width:20%">
                <paper-button slot="dropdown-trigger">Assignment&nbsp;<iron-icon icon="assignment"></iron-icon>
                </paper-button>
                <paper-listbox slot="dropdown-content" style="width:300px">
                    <paper-collapse-item header="Assignment1">
                        <paper-collapse-item-content>
                            <paper-item>Question1
                                <paper-button raised class="green startbutton" id="ass1-q1" on-tap="startRecording">
                                    start
                                    <iron-icon icon="av:fiber-manual-record"></iron-icon>
                                </paper-button>
                                <paper-button disabled raised class="disabled backbutton">
                                    <iron-icon icon="undo"></iron-icon>
                                </paper-button>
                            </paper-item>
                            <paper-item>Question2
                                <paper-button raised class="green startbutton" id="ass1-q2" on-tap="startRecording">
                                    start
                                    <iron-icon icon="av:fiber-manual-record"></iron-icon>
                                </paper-button>
                                <paper-button disabled raised class="disabled backbutton">
                                    <iron-icon icon="undo"></iron-icon>
                                </paper-button>
                            </paper-item>
                        </paper-collapse-item-content>
                    </paper-collapse-item>
                    <paper-collapse-item header="Assignment2">
                        <paper-collapse-item-content>
                            <paper-item>Question1
                                <paper-button raised class="green startbutton" id="ass2-q1" on-tap="startRecording">
                                    start
                                    <iron-icon icon="av:fiber-manual-record"></iron-icon>
                                </paper-button>
                                <paper-button disabled class="disabled">
                                    <iron-icon icon="undo"></iron-icon>
                                </paper-button>
                            </paper-item>
                            <paper-item>Question2
                                <paper-button raised class="green startbutton" id="ass2-q2" on-tap="startRecording">
                                    start
                                    <iron-icon icon="av:fiber-manual-record"></iron-icon>
                                </paper-button>
                                <paper-button disabled class="disabled">
                                    <iron-icon icon="undo"></iron-icon>
                                </paper-button>
                            </paper-item>
                        </paper-collapse-item-content>
                    </paper-collapse-item>
                </paper-listbox>
            </paper-menu-button>
        </paper-toolbar>
        <simple-dialog id="dialog">
            <h2>Please upload your files here</h2>
            <vaadin-upload accept=".pdf,.doc,.docx,.xml" target="serverUrl" method="POST" timeout="300000"
                           headers="{'X-Custom-Header': 'value'}"
                           form-data-name="my-attachment">
                <iron-icon slot="drop-label-icon" icon="description"></iron-icon>
                <span slot="drop-label">Drop your files here</span>
            </vaadin-upload>
            <paper-button dialog-dismiss>Cancel</paper-button>
            <paper-button dialog-confirm autofocus>submit</paper-button>
            <script src="https://cdn.vaadin.com/vaadin-elements/master/mock-http-request/lib/mock.js"></script>
            <script>
                function mockXhrGenerator(file) {
                    var xhr = new MockHttpRequest();
                    xhr.upload = {};
                    xhr.onsend = function () {
                        var total = file && file.size || 1024, done = 0;

                        function start() {
                            setTimeout(progress, 1000);
                        }

                        function progress() {
                            xhr.upload.onprogress({total: total, loaded: done});
                            if (done < total) {
                                setTimeout(progress, 200);
                                done = Math.min(total, done + 254000);
                            } else if (!file.abort) {
                                setTimeout(finish, 1000);
                            }
                        }

                        function finish() {
                            xhr.receive(200, '{"message":"OK"}');
                        }

                        start();
                    };
                    return xhr;
                }

                window.addEventListener('WebComponentsReady', function () {
                    // Monkey-patch vaadin-upload prototype to use MockHttpRequest
                    Object.getPrototypeOf(document.createElement('vaadin-upload'))._createXhr = mockXhrGenerator;
                });

            </script>
        </simple-dialog>

    </template>
    <script>
        class StlmNavbar3 extends Polymer.Element {
            static get is() {
                return 'stlm-navbar3';
            }

            toggleDialog() {
                this.$.dialog.open();
            }

            startRecording(e) {
                // when user clicks on icon
                if (null === e.target.nextElementSibling) {
                    if (localStorage.getItem(e.target.parentNode.id) == 'started') {
                        this.shadowRoot.getElementById(e.target.parentNode.id).classList.remove('red');
                        this.shadowRoot.getElementById(e.target.parentNode.id).classList.add('green');
                        localStorage.setItem(e.target.parentNode.id, 'stopped');
                        e.target.parentNode.innerHTML = 'START <iron-icon icon="av:fiber-manual-record"></iron-icon>';
                    } else {
                        this.shadowRoot.getElementById(e.target.parentNode.id).classList.remove('green');
                        this.shadowRoot.getElementById(e.target.parentNode.id).classList.add('red');
                        localStorage.setItem(e.target.parentNode.id, 'started');
                        e.target.parentNode.innerHTML = 'STOP <iron-icon icon="av:stop"></iron-icon>';
                    }
                } else { // when user clicks on the button
                    if (localStorage.getItem(e.target.id) == 'started') {
                        this.shadowRoot.getElementById(e.target.id).classList.remove('red');
                        this.shadowRoot.getElementById(e.target.id).classList.add('green');
                        localStorage.setItem(e.target.id, 'stopped');
                        e.target.innerHTML = 'START <iron-icon icon="av:fiber-manual-record"></iron-icon>';
                    } else {
                        this.shadowRoot.getElementById(e.target.id).classList.remove('green');
                        this.shadowRoot.getElementById(e.target.id).classList.add('red');
                        localStorage.setItem(e.target.id, 'started');
                        e.target.innerHTML = 'STOP <iron-icon icon="av:stop"></iron-icon>';
                    }
                }
            }

            constructor() {
                super();
                this.suggestions = [{"id": "1", "name": "HIM M200"}, {"id": "2", "name": "HIM M220"}];
            }

            ready() {
                super.ready();
                for (var a in localStorage) {
                    if (a.includes('ass')) {
                        if (localStorage.getItem(a) == 'started') {
                            this.shadowRoot.getElementById(a).classList.remove('green');
                            this.shadowRoot.getElementById(a).classList.add('red');
                            this.shadowRoot.getElementById(a).innerHTML = 'STOP <iron-icon icon="av:stop"></iron-icon>';
                        } else if (localStorage.getItem(a) == 'stopped') {
                            this.shadowRoot.getElementById(a).classList.remove('red');
                            this.shadowRoot.getElementById(a).classList.add('green');
                            this.shadowRoot.getElementById(a).innerHTML = 'START <iron-icon icon="av:fiber-manual-record"></iron-icon>';
                        }
                    }
                }
            }
        }

        window.customElements.define(StlmNavbar3.is, StlmNavbar3);
    </script>
</dom-module>