<link rel="import" href="../bower_components/polymer/polymer-element.html">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<dom-module id="stlm-annotation">
    <template>
        <div id="selectableArea">
            Systolic blood pressure <br/>
            Synonyms <br/>
            SBP <br/>
            SYSTOLIC <br/>
            Search Terms <br/>
            Short Name SBP <br/>
            Description A patient's systolic blood pressure measurement (taken with a manual cuff in either a sitting or
            <br/>
            standing position)<br/>
            Class Finding<br/>
            Datatype Numeric<br/>
        </div>

        <div id="contextMenu">
            <ul>
                <li id="annotateThis"></li>
                <li><input id="annotationField" type="text"/><input type="button" onclick="saveAnnotation()"
                                                                    value="Submit"></li>
            </ul>
        </div>

        <script>
            function saveAnnotation() {
                var annotation = document.getElementById('annotateThis').innerHTML + ':'
                    + document.getElementById('annotationField').value;
                window.localStorage.setItem(now().toDateString(), annotation);
            }
        </script>

        <style>
            #contextMenu {
                position: absolute;
                display: none;
            }

            #contextMenu ul, #context-menu li {
                list-style: none;
                margin: 0;
                padding: 0;
                background: white;
            }

            #contextMenu {
                border: solid 1px #CCC;
            }

            #contextMenu li {
                border-bottom: solid 1px #CCC;
            }

            #contextMenu li:last-child {
                border: none;
            }

            #contextMenu li a {
                display: block;
                padding: 5px 10px;
                text-decoration: none;
                color: blue;
            }

            #contextMenu li a:hover {
                background: blue;
                color: #FFF;
            }
        </style>
    </template>

    <script>
        class StlmAnnotation extends Polymer.Element {
            static get is() {
                return "stlm-annotation";
            }

            ready() {
                super.ready();
                var menuArea = this.$.selectableArea;
                var menu = this.$.contextMenu;
                var annotateThis = this.$.annotateThis;
                var annotationField = this.$.annotationField;

                menuArea.oncontextmenu = function (e) {
                    var text = window.getSelection().toString();
                    annotateThis.innerHTML = text;
                    console.log(text);
                    if (text.length > 0) {
                        annotationField.value = '';
                        e.preventDefault();
                        menu.style.left = e.pageX + 'px';
                        menu.style.top = e.pageY + 'px';
                        menu.style.display = 'block';
                    } else {
                        menu.style.display = 'none';
                    }
                }
            }
        }

        customElements.define(StlmAnnotation.is, StlmAnnotation);
    </script>

</dom-module>